# Process Check Configuration for SCCM Distribution Point
# Monitors critical processes for Distribution Point functionality

init_config:

instances:
  # IIS Worker Process - Critical for Distribution Point web services
  - name: iis_worker
    search_string: ['w3wp.exe']
    exact_match: false
    tags:
      - process:iis-worker
      - service:iis
      - role:sccm-distribution-point
    thresholds:
      critical: [1, 10, 5m]  # At least 1, max 10 processes sustained
      warning: [1, 5, 5m]
    
  # SCCM Distribution Point Host
  - name: sms_dp_host
    search_string: ['SMS_DP_HOST.exe']
    exact_match: false
    tags:
      - process:sccm-dp-host
      - service:sccm-dp
      - role:sccm-distribution-point
    thresholds:
      critical: [1, 1, 5m]  # Should be exactly 1 running
      warning: [1, 1, 5m]
    
  # SCCM Distribution Point Monitor
  - name: sms_dp_monitor
    search_string: ['SMS_DP_MONITOR.exe']
    exact_match: false
    tags:
      - process:sccm-dp-monitor
      - service:sccm-dp
      - role:sccm-distribution-point
    thresholds:
      critical: [1, 1, 5m]  # Should be exactly 1 running
      warning: [1, 1, 5m]
  
  # WMI Provider Host
  - name: wmi_provider_host
    search_string: ['wmiprvse.exe']
    exact_match: false
    tags:
      - process:wmi-provider
      - service:wmi
      - role:sccm-distribution-point
    thresholds:
      critical: [1, 20, 5m]  # At least 1, max 20 processes
      warning: [1, 10, 5m]
    
  # BITS Service (Background Transfers)
  - name: bits_service
    search_string: ['svchost.exe']
    user: LOCAL SERVICE|NETWORK SERVICE
    exact_match: false
    tags:
      - process:bits-service
      - service:bits
      - role:sccm-distribution-point
    thresholds:
      critical: [1, 10, 5m]  # BITS-related svchost processes
      warning: [1, 5, 5m]
    
  # WDS Server Process (if PXE enabled)
  - name: wds_server
    search_string: ['wdsserver.exe']
    exact_match: false
    tags:
      - process:wds-server
      - service:wds
      - role:sccm-distribution-point
    thresholds:
      critical: [0, 1, 5m]  # Optional (0 or 1 process)
      warning: [0, 1, 5m]
