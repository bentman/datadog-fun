[
  {
    "name": "DP Service State - Web Infrastructure (W3SVC)",
    "type": "service check",
    "query": "check(\"windows_service.state\").over(\"role:sccm-distribution-point\",\"service_group:web-infrastructure\").by(\"service\").last(\"5m\") != \"OK\"",
    "message": "{{#is_alert}}Service {{service.name}} on {{host.name}} is not running (group: web-infrastructure).{{/is_alert}}\n{{#is_no_data}}No data received for windows_service.state in the last {{no_data_timeframe}} minutes.{{/is_no_data}}",
    "tags": ["role:sccm-distribution-point", "sccmrole:sccm-srv", "approle:sccm-dp-srv"],
    "options": {
      "notify_no_data": true,
      "no_data_timeframe": 10,
      "renotify_interval": 60,
      "evaluation_delay": 120,
      "new_host_delay": 300,
      "include_tags": true
    }
  },
  {
    "name": "DP Service State - Windows Infrastructure",
    "type": "service check",
    "query": "check(\"windows_service.state\").over(\"role:sccm-distribution-point\",\"service_group:windows-infrastructure\").by(\"service\").last(\"5m\") != \"OK\"",
    "message": "{{#is_alert}}Service {{service.name}} on {{host.name}} is not running (group: windows-infrastructure).{{/is_alert}}\n{{#is_no_data}}No data received for windows_service.state in the last {{no_data_timeframe}} minutes.{{/is_no_data}}",
    "tags": ["role:sccm-distribution-point", "sccmrole:sccm-srv", "approle:sccm-dp-srv"],
    "options": {
      "notify_no_data": true,
      "no_data_timeframe": 10,
      "renotify_interval": 60,
      "evaluation_delay": 120,
      "new_host_delay": 300,
      "include_tags": true
    }
  },
  {
    "name": "DP Service State - Content Distribution",
    "type": "service check",
    "query": "check(\"windows_service.state\").over(\"role:sccm-distribution-point\",\"service_group:content-distribution\").by(\"service\").last(\"5m\") != \"OK\"",
    "message": "{{#is_alert}}Service {{service.name}} on {{host.name}} is not running (group: content-distribution).{{/is_alert}}\n{{#is_no_data}}No data received for windows_service.state in the last {{no_data_timeframe}} minutes.{{/is_no_data}}",
    "tags": ["role:sccm-distribution-point", "sccmrole:sccm-srv", "approle:sccm-dp-srv"],
    "options": {
      "notify_no_data": true,
      "no_data_timeframe": 10,
      "renotify_interval": 60,
      "evaluation_delay": 120,
      "new_host_delay": 300,
      "include_tags": true
    }
  },
  {
    "name": "DP Logs - System Critical Events",
    "type": "log alert",
    "query": "logs(\"source:windows.events channel:System role:sccm-distribution-point @evt.id:(7000 OR 7001 OR 7031 OR 7034 OR 7036 OR 10016 OR 6008)\").index(\"*\").rollup(\"count\").last(\"5m\") > 0",
    "message": "{{#is_alert}}System critical events detected on distribution points. Investigate in Logs Explorer.{{/is_alert}}",
    "tags": ["role:sccm-distribution-point", "sccmrole:sccm-srv", "approle:sccm-dp-srv"],
    "options": {
      "thresholds": { "critical": 1 },
      "notify_no_data": false,
      "renotify_interval": 60,
      "evaluation_delay": 120,
      "enable_logs_sample": true
    }
  },
  {
    "name": "DP Logs - Application Errors (DP Components)",
    "type": "log alert",
    "query": "logs(\"source:windows.events channel:Application role:sccm-distribution-point @evt.id:(2301 OR 2302 OR 2303 OR 2315 OR 2316)\").index(\"*\").rollup(\"count\").last(\"5m\") > 0",
    "message": "{{#is_alert}}SCCM Distribution Point application errors detected. Investigate in Logs Explorer.{{/is_alert}}",
    "tags": ["role:sccm-distribution-point", "sccmrole:sccm-srv", "approle:sccm-dp-srv"],
    "options": {
      "thresholds": { "critical": 1 },
      "notify_no_data": false,
      "renotify_interval": 60,
      "evaluation_delay": 120,
      "enable_logs_sample": true
    }
  },
  {
    "name": "DP Logs - IIS Errors",
    "type": "log alert",
    "query": "logs(\"source:windows.events channel:Application role:sccm-distribution-point @evt.id:(1309 OR 1325 OR 2268)\").index(\"*\").rollup(\"count\").last(\"5m\") > 0",
    "message": "{{#is_alert}}IIS application errors detected on distribution points. Investigate in Logs Explorer.{{/is_alert}}",
    "tags": ["role:sccm-distribution-point", "sccmrole:sccm-srv", "approle:sccm-dp-srv"],
    "options": {
      "thresholds": { "critical": 1 },
      "notify_no_data": false,
      "renotify_interval": 60,
      "evaluation_delay": 120,
      "enable_logs_sample": true
    }
  },
  {
    "name": "DP Logs - Application Errors (Generic)",
    "type": "log alert",
    "query": "logs(\"source:windows.events channel:Application role:sccm-distribution-point @evt.id:(1000 OR 1026 OR 1033)\").index(\"*\").rollup(\"count\").last(\"5m\") > 0",
    "message": "{{#is_alert}}Generic application errors detected on distribution points. Investigate in Logs Explorer.{{/is_alert}}",
    "tags": ["role:sccm-distribution-point", "sccmrole:sccm-srv", "approle:sccm-dp-srv"],
    "options": {
      "thresholds": { "critical": 1 },
      "notify_no_data": false,
      "renotify_interval": 60,
      "evaluation_delay": 120,
      "enable_logs_sample": true
    }
  },
  {
    "name": "DP Logs - Security Authentication Failures",
    "type": "log alert",
    "query": "logs(\"source:windows.events channel:Security role:sccm-distribution-point @evt.id:(4625 OR 4771 OR 4776)\").index(\"*\").rollup(\"count\").last(\"5m\") > 0",
    "message": "{{#is_alert}}Security authentication failures detected on distribution points. Investigate in Logs Explorer.{{/is_alert}}",
    "tags": ["role:sccm-distribution-point", "sccmrole:sccm-srv", "approle:sccm-dp-srv"],
    "options": {
      "thresholds": { "critical": 1 },
      "notify_no_data": false,
      "renotify_interval": 60,
      "evaluation_delay": 120,
      "enable_logs_sample": true
    }
  }
]
