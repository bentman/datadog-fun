[
  {
    "name": "Reporting Service State - SSRS Core",
    "type": "service check",
    "query": "check(\"windows_service.state\").over(\"role:sccm-sql-reporting-server\",\"service_group:ssrs-core\").by(\"service\").last(\"5m\") != \"OK\"",
    "message": "{{#is_alert}}Service {{service.name}} on {{host.name}} is not running (group: ssrs-core).{{/is_alert}}\n{{#is_no_data}}No data received for windows_service.state in the last {{no_data_timeframe}} minutes.{{/is_no_data}}",
    "tags": ["role:sccm-sql-reporting-server", "sccmrole:sccm-sql", "approle:sccm-reporting-srv"],
    "options": {
      "notify_no_data": true,
      "no_data_timeframe": 10,
      "renotify_interval": 60,
      "evaluation_delay": 120,
      "new_host_delay": 300,
      "include_tags": true
    }
  },
  {
    "name": "Reporting Service State - Local SQL Server",
    "type": "service check",
    "query": "check(\"windows_service.state\").over(\"role:sccm-sql-reporting-server\",\"service_group:sql-server-local\").by(\"service\").last(\"5m\") != \"OK\"",
    "message": "{{#is_alert}}Service {{service.name}} on {{host.name}} is not running (group: sql-server-local).{{/is_alert}}\n{{#is_no_data}}No data received for windows_service.state in the last {{no_data_timeframe}} minutes.{{/is_no_data}}",
    "tags": ["role:sccm-sql-reporting-server", "sccmrole:sccm-sql", "approle:sccm-reporting-srv"],
    "options": {
      "notify_no_data": true,
      "no_data_timeframe": 10,
      "renotify_interval": 60,
      "evaluation_delay": 120,
      "new_host_delay": 300,
      "include_tags": true
    }
  },
  {
    "name": "Reporting Service State - WSUS Core",
    "type": "service check",
    "query": "check(\"windows_service.state\").over(\"role:sccm-sql-reporting-server\",\"service_group:wsus-core\").by(\"service\").last(\"5m\") != \"OK\"",
    "message": "{{#is_alert}}Service {{service.name}} on {{host.name}} is not running (group: wsus-core).{{/is_alert}}\n{{#is_no_data}}No data received for windows_service.state in the last {{no_data_timeframe}} minutes.{{/is_no_data}}",
    "tags": ["role:sccm-sql-reporting-server", "sccmrole:sccm-sql", "approle:sccm-reporting-srv"],
    "options": {
      "notify_no_data": true,
      "no_data_timeframe": 10,
      "renotify_interval": 60,
      "evaluation_delay": 120,
      "new_host_delay": 300,
      "include_tags": true
    }
  },
  {
    "name": "Reporting Service State - Web Infrastructure",
    "type": "service check",
    "query": "check(\"windows_service.state\").over(\"role:sccm-sql-reporting-server\",\"service_group:web-infrastructure\").by(\"service\").last(\"5m\") != \"OK\"",
    "message": "{{#is_alert}}Service {{service.name}} on {{host.name}} is not running (group: web-infrastructure).{{/is_alert}}\n{{#is_no_data}}No data received for windows_service.state in the last {{no_data_timeframe}} minutes.{{/is_no_data}}",
    "tags": ["role:sccm-sql-reporting-server", "sccmrole:sccm-sql", "approle:sccm-reporting-srv"],
    "options": {
      "notify_no_data": true,
      "no_data_timeframe": 10,
      "renotify_interval": 60,
      "evaluation_delay": 120,
      "new_host_delay": 300,
      "include_tags": true
    }
  },
  {
    "name": "Reporting Service State - Windows Infrastructure",
    "type": "service check",
    "query": "check(\"windows_service.state\").over(\"role:sccm-sql-reporting-server\",\"service_group:windows-infrastructure\").by(\"service\").last(\"5m\") != \"OK\"",
    "message": "{{#is_alert}}Service {{service.name}} on {{host.name}} is not running (group: windows-infrastructure).{{/is_alert}}\n{{#is_no_data}}No data received for windows_service.state in the last {{no_data_timeframe}} minutes.{{/is_no_data}}",
    "tags": ["role:sccm-sql-reporting-server", "sccmrole:sccm-sql", "approle:sccm-reporting-srv"],
    "options": {
      "notify_no_data": true,
      "no_data_timeframe": 10,
      "renotify_interval": 60,
      "evaluation_delay": 120,
      "new_host_delay": 300,
      "include_tags": true
    }
  },
  {
    "name": "Reporting Service State - IIS Application Pools",
    "type": "service check",
    "query": "check(\"windows_service.state\").over(\"role:sccm-sql-reporting-server\",\"service_group:iis-application-pools\").by(\"service\").last(\"5m\") != \"OK\"",
    "message": "{{#is_alert}}Service {{service.name}} on {{host.name}} is not running (group: iis-application-pools).{{/is_alert}}\n{{#is_no_data}}No data received for windows_service.state in the last {{no_data_timeframe}} minutes.{{/is_no_data}}",
    "tags": ["role:sccm-sql-reporting-server", "sccmrole:sccm-sql", "approle:sccm-reporting-srv"],
    "options": {
      "notify_no_data": true,
      "no_data_timeframe": 10,
      "renotify_interval": 60,
      "evaluation_delay": 120,
      "new_host_delay": 300,
      "include_tags": true
    }
  },
  {
    "name": "Reporting Logs - System Critical Events",
    "type": "log alert",
    "query": "logs(\"source:windows.events channel:System role:sccm-sql-reporting-server @evt.id:(7000 OR 7001 OR 7031 OR 7034 OR 7036 OR 7032 OR 6008)\").index(\"*\").rollup(\"count\").last(\"5m\") > 0",
    "message": "{{#is_alert}}System critical events detected on reporting servers. Investigate in Logs Explorer.{{/is_alert}}",
    "tags": ["role:sccm-sql-reporting-server", "sccmrole:sccm-sql", "approle:sccm-reporting-srv"],
    "options": {
      "thresholds": { "critical": 1 },
      "notify_no_data": false,
      "renotify_interval": 60,
      "evaluation_delay": 120,
      "enable_logs_sample": true
    }
  },
  {
    "name": "Reporting Logs - SSRS Errors",
    "type": "log alert",
    "query": "logs(\"source:windows.events channel:Application role:sccm-sql-reporting-server @evt.id:(121 OR 133 OR 1530 OR 153)\").index(\"*\").rollup(\"count\").last(\"5m\") > 0",
    "message": "{{#is_alert}}SSRS application errors detected. Investigate in Logs Explorer.{{/is_alert}}",
    "tags": ["role:sccm-sql-reporting-server", "sccmrole:sccm-sql", "approle:sccm-reporting-srv"],
    "options": {
      "thresholds": { "critical": 1 },
      "notify_no_data": false,
      "renotify_interval": 60,
      "evaluation_delay": 120,
      "enable_logs_sample": true
    }
  },
  {
    "name": "Reporting Logs - SQL Connection Errors",
    "type": "log alert",
    "query": "logs(\"source:windows.events channel:Application role:sccm-sql-reporting-server @evt.id:(18456 OR 18452 OR 5858)\").index(\"*\").rollup(\"count\").last(\"5m\") > 0",
    "message": "{{#is_alert}}SQL connection/authentication errors detected on reporting servers. Investigate in Logs Explorer.{{/is_alert}}",
    "tags": ["role:sccm-sql-reporting-server", "sccmrole:sccm-sql", "approle:sccm-reporting-srv"],
    "options": {
      "thresholds": { "critical": 1 },
      "notify_no_data": false,
      "renotify_interval": 60,
      "evaluation_delay": 120,
      "enable_logs_sample": true
    }
  }
]
