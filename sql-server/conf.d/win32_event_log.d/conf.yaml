# Windows Event Log Configuration for SCCM SQL Server
# Monitors critical Windows and SQL Server events

init_config:

instances:
  # System Event Log - Critical and Error events
  - channels:
      - path: System
        type: windows_event_log
        filters:
          - query: '*[System[(Level=1 or Level=2)]]'  # Critical and Error events
    tags:
      - source:windows-system
      - role:sccm-sql-server
    
  # Application Event Log - SQL Server related events
  - channels:
      - path: Application
        type: windows_event_log
        filters:
          - query: '*[System[Provider[@Name="MSSQLSERVER"] and (Level=1 or Level=2 or Level=3)]]'  # SQL Server events
    tags:
      - source:sqlserver-application
      - role:sccm-sql-server
    
  # Application Event Log - SQL Server Agent events
  - channels:
      - path: Application
        type: windows_event_log
        filters:
          - query: '*[System[Provider[@Name="SQLSERVERAGENT"] and (Level=1 or Level=2 or Level=3)]]'  # SQL Agent events
    tags:
      - source:sqlserver-agent-application
      - role:sccm-sql-server
    
  # Application Event Log - SCCM related events
  - channels:
      - path: Application
        type: windows_event_log
        filters:
          - query: '*[System[Provider[@Name="SMS Server"] and (Level=1 or Level=2 or Level=3)]]'  # SCCM events
    tags:
      - source:sccm-application
      - role:sccm-sql-server
    
  # Security Event Log - Authentication events
  - channels:
      - path: Security
        type: windows_event_log
        filters:
          - query: '*[System[(EventID=4625 or EventID=4648 or EventID=4771 or EventID=4776 or EventID=18456)]]'  # Failed logons including SQL
    tags:
      - source:windows-security
      - role:sccm-sql-server
    
  # SQL Server specific event logs
  - channels:
      - path: Microsoft-SQLServer-Relational-Engine/Operational
        type: windows_event_log
        filters:
          - query: '*[System[(Level=1 or Level=2 or Level=3)]]'  # Critical, Error, Warning
    tags:
      - source:sqlserver-engine-operational
      - role:sccm-sql-server